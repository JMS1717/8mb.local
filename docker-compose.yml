services:
  8mblocal:
    # RTX 50-series (Blackwell): jms1717/8mblocal:rtx50-working (CUDA 13.0.1, driver 550+)
    # Other NVIDIA GPUs: jms1717/8mblocal:latest (CUDA 12.2, driver 535+)
    # See RTX50-WORKING.md for RTX 50-series setup requirements
    image: jms1717/8mblocal:rtx50-working
    container_name: 8mblocal
    ports:
      - "8001:8001"
    volumes:
      - ./uploads:/app/uploads
      - ./outputs:/app/outputs
      - ./.env:/app/.env  # optional custom settings
      # RTX 50-series fix: Mount full WSL driver directory for CUDA 13.0 DXG libraries
      - /usr/lib/wsl/drivers:/usr/lib/wsl/drivers:ro
    environment:
      - REDIS_URL=redis://127.0.0.1:6379/0
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,video,utility
    # Enable NVIDIA GPU acceleration (Docker Desktop / Linux with nvidia-container-toolkit)
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    # Optional: enable VAAPI on Linux (Intel/AMD)
    # devices:
    #   - "/dev/dri:/dev/dri"
    restart: unless-stopped
