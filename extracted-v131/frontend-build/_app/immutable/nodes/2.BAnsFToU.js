import{f as u,a as v,c as se,t as qe}from"../chunks/BZqCPlBW.js";import"../chunks/CS0-jjX0.js";import{o as Mr}from"../chunks/BPGtCBdR.js";import{F as zr,al as pe,am as Dr,D as N,G as h,I as i,J as n,z as e,K as jr,N as t,M as f,P as l,O as ee,u as m,Q as Fe,A as Ir,L as Tr}from"../chunks/U2DDJ_0W.js";import{e as $,s as y}from"../chunks/CY5WxPnE.js";import{i as g}from"../chunks/DI9HNUez.js";import{e as Qe,i as Ze,r as xe,s as $e}from"../chunks/C9DCMbO9.js";import{s as ya}from"../chunks/BVi6EA_b.js";import{a as ia,c as Oe,b as ca}from"../chunks/DsOkiI6p.js";import{b as Er}from"../chunks/D33e11yZ.js";import{i as qr}from"../chunks/CQGLq4BK.js";const Fr=globalThis.__sveltekit_ogva8t.env,Ct=Fr.PUBLIC_BACKEND_URL||"",ve=Ct&&Ct.trim()!==""?Ct.replace(/\/$/,""):"";function Or(A,he,F=128,U){return new Promise((O,G)=>{const ue=new FormData;ue.append("file",A),ue.append("target_size_mb",String(he)),ue.append("audio_bitrate_kbps",String(F));const Q=new XMLHttpRequest;Q.open("POST",`${ve}/api/upload`),U!=null&&U.auth&&Q.setRequestHeader("Authorization","Basic "+btoa(`${U.auth.user}:${U.auth.pass}`)),Q.upload.onprogress=fe=>{if(fe.lengthComputable&&(U!=null&&U.onProgress)){const J=Math.max(0,Math.min(100,Math.round(fe.loaded/fe.total*100)));U.onProgress(J)}},Q.onload=()=>{try{Q.status>=200&&Q.status<300?O(JSON.parse(Q.responseText||"{}")):G(new Error(Q.responseText||`HTTP ${Q.status}`))}catch(fe){G(fe)}},Q.onerror=()=>G(new Error("Network error")),Q.send(ue)})}async function Br(A,he){const F={"Content-Type":"application/json"},U=await fetch(`${ve}/api/compress`,{method:"POST",body:JSON.stringify(A),headers:F});if(!U.ok)throw new Error(await U.text());return U.json()}function ys(A,he){let F;return ve?F=`${ve}/api/stream/${A}`:F=`/api/stream/${A}`,console.log("Opening SSE connection to:",F),new EventSource(F)}function Me(A){return`${ve}/api/jobs/${A}/download`}async function Hr(A){const he=await fetch(`${ve}/api/jobs/${encodeURIComponent(A)}/cancel`,{method:"POST"});if(!he.ok)throw new Error(await he.text());return he.json()}async function Lr(){const A=await fetch(`${ve}/api/codecs/available`);if(!A.ok)throw new Error(await A.text());return A.json()}async function Nr(){const A=await fetch(`${ve}/api/system/capabilities`);if(!A.ok)throw new Error(await A.text());return A.json()}async function Ur(){const A=await fetch(`${ve}/api/system/encoder-tests`);if(!A.ok)throw new Error(await A.text());return A.json()}async function Gr(){const A=await fetch(`${ve}/api/version`);if(!A.ok)throw new Error(await A.text());return A.json()}async function Vr(){const A=await fetch(`${ve}/api/settings/preset-profiles`);if(!A.ok)throw new Error(await A.text());return A.json()}async function Kr(){const A=await fetch(`${ve}/api/settings/size-buttons`);if(!A.ok)throw new Error(await A.text());return A.json()}var Wr=u('<span class="align-middle text-xs ml-2 px-2 py-0.5 rounded border border-gray-700 text-gray-400"> </span>'),Qr=u('<span class="inline-flex items-center gap-2 text-green-300"><span class="w-2 h-2 bg-green-500 rounded-full"></span> GPU encoding available</span>'),Zr=u('<span class="inline-flex items-center gap-2 text-amber-300" title="Hardware encoder tests did not pass; encoding may fall back to CPU."><span class="w-2 h-2 bg-amber-500 rounded-full"></span> GPU encoding unavailable ‚Äî falling back to CPU</span>'),$r=u('<span class="text-gray-400">CPU-only environment</span>'),Jr=u('<p class="text-sm"> </p> <p class="text-sm"> </p> <p class="text-sm">Hardware: <span class="inline-flex items-center gap-1"><span class="inline-block w-2 h-2 rounded-full"></span> </span></p> <p class="text-sm mt-1"><!></p>',1),Yr=u('<p class="text-sm text-amber-400"> </p>'),Rr=u('<p class="text-sm opacity-70">Detecting system capabilities‚Ä¶</p>'),Xr=u("<li> </li>"),eo=u('<p class="text-xs opacity-70 mt-1"> </p>'),ao=u('<ul class="text-sm space-y-1"></ul> <!>',1),to=u('<p class="text-sm opacity-70">No dedicated GPUs detected</p>'),so=u('<span class="text-green-400">PASS</span>'),ro=u('<span class="text-red-400">FAIL</span>'),oo=u('<span class="text-green-400 text-xs"> </span>'),lo=u('<span class="text-red-400 text-xs"> </span>'),no=u('<div class="ml-3 mt-1 flex items-center justify-between opacity-80"><span>Decode:</span> <!></div>'),io=u('<span class="text-green-400 text-xs"> </span>'),co=u('<span class="text-red-400 text-xs"> </span>'),vo=u('<li class="flex flex-col"><div class="flex items-center justify-between"><span class="font-medium"> <span class="opacity-60"> </span></span> <!></div> <!> <div class="ml-3 mt-1 flex items-center justify-between opacity-80"><span>Encode:</span> <!></div></li>'),po=u('<div class="mt-3 text-xs text-amber-300 bg-amber-900/20 border border-amber-700/30 rounded p-2">GPU present but encoders failed. Common causes: <ul class="list-disc ml-4 mt-1 opacity-90"><li>Container not started with GPU access (Compose gpus: all)</li> <li>Docker Desktop (Windows): enable WSL2 GPU support and set Resources ‚Üí GPU</li> <li>Outdated or missing NVIDIA driver</li> <li>Permissions: NVENC init "Operation not permitted" inside container</li></ul></div>'),uo=u('<details class="mt-3"><summary class="cursor-pointer text-sm">Encoder tests</summary> <ul class="mt-2 text-xs space-y-2"></ul> <!></details>'),fo=u('<span class="opacity-70"> </span>'),_o=u('<div class="mt-2 flex items-center gap-2"><p class="text-sm text-gray-400"> <!></p> <button class="btn" title="Clear selected file">Clear</button></div>'),mo=u('<div class="mt-4"><p class="text-xs text-gray-400 mb-1"> </p> <div class="h-2 bg-gray-800 rounded"><div class="h-2 bg-blue-600 rounded"></div></div> <p class="text-xs text-gray-500 mt-1">Reading file properties and calculating optimal bitrates...</p></div>'),go=u('<button class="btn"> </button>'),bo=u('<option class="svelte-1uha8ag"> </option>'),xo=u('<p class="text-xs text-gray-400 mt-1"><span class="inline-block w-2 h-2 rounded-full mr-1"></span> </p>'),ho=u('<p class="text-xs text-gray-400 mt-1"><span class="inline-block w-2 h-2 rounded-full bg-gray-500 mr-1"></span> CPU encoding (no GPU detected)</p>'),yo=u("<option> </option>"),wo=u('<p class="text-xs text-gray-400 mt-1">Disabled (audio muted)</p>'),Ao=u('<p class="text-xs text-gray-400 mt-1">Auto audio bitrate is ON (will downshift for extreme compression)</p>'),ko=u(`<label class="flex items-center gap-2 cursor-pointer" title="Fragmented MP4 eliminates the long 'finalizing' step (99%->100%). Works with all modern players and Discord. Recommended!"><input type="checkbox" class="w-4 h-4"/> <span class="text-sm">üöÄ Fast finalize (recommended)</span></label>`),So=u('<p class="mt-2 text-xs text-amber-400"> </p>'),Po=u('<span class="text-blue-400"> </span> <br/>',1),Co=u('<p class="text-xs opacity-80"> </p>'),Mo=u('<p class="text-amber-400 text-sm mt-1"> </p>'),zo=u('<div class="card"><p class="text-sm"><!> </p> <!> <!></div>'),Do=u('<div class="mt-2 flex gap-2 items-center"><button class="btn">Reconnect to progress</button> <span class="text-xs opacity-70">This just reopens the live log/progress stream; the job may still be running on the server.</span></div>'),jo=u('<div class="card border-red-500"><p class="text-red-400"> </p> <!></div>'),Io=u(" <!>",1),To=u('<button class="btn"> </button>'),Eo=u('<p class="text-sm text-gray-300">Final size: <span class="font-semibold text-white"> </span></p>'),qo=u('<p class="text-sm text-gray-300">Your file is ready to download</p>'),Fo=u('<div class="card bg-gradient-to-r from-green-900/30 to-blue-900/30 border-2 border-green-500/50"><div class="flex items-center justify-between gap-4 flex-wrap"><div class="flex-1"><h3 class="text-lg font-bold text-green-400 mb-1">‚úì Compression Complete!</h3> <!></div> <a class="btn bg-green-600 hover:bg-green-700 text-white font-bold px-8 py-3 text-lg shadow-lg" target="_blank">‚¨áÔ∏è Download</a></div></div>'),Oo=u('<div class="text-sm text-gray-300"> </div>'),Bo=u('<span class="text-xs px-2 py-1 rounded bg-green-900/40 text-green-300 border border-green-700/40">Encoder: NVIDIA NVENC</span>'),Ho=u('<span class="text-xs px-2 py-1 rounded bg-green-900/40 text-green-300 border border-green-700/40">Encoder: Intel QSV</span>'),Lo=u('<span class="text-xs px-2 py-1 rounded bg-green-900/40 text-green-300 border border-green-700/40">Encoder: AMD AMF</span>'),No=u('<span class="text-xs px-2 py-1 rounded bg-green-900/40 text-green-300 border border-green-700/40">Encoder: VAAPI</span>'),Uo=u('<span class="text-xs px-2 py-1 rounded bg-slate-800 text-slate-200 border border-slate-600/40"> </span>'),Go=u('<span class="text-xs px-2 py-1 rounded bg-slate-800 text-slate-300 border border-slate-600/40">Encoder: detecting‚Ä¶</span>'),Vo=u('<div class="text-xs text-amber-300 mt-1">Hardware encoder unavailable for this job ‚Äî using CPU fallback.</div>'),Ko=u('<div class="mb-3 p-3 bg-amber-900/30 border-2 border-amber-500 rounded-lg animate-pulse"><div class="flex items-center gap-2"><span class="text-2xl">üîÑ</span> <div class="flex-1"><div class="font-bold text-amber-300 text-lg">AUTOMATIC RETRY IN PROGRESS</div> <div class="text-sm text-amber-200 mt-1"> </div> <div class="text-xs text-gray-400 mt-1">This is normal - optimizing output to meet target size</div></div></div></div>'),Wo=u('<span class="text-blue-300">(finalizing‚Ä¶)</span>'),Qo=u('<span class="text-green-300"> </span>'),Zo=u("<span> </span>"),$o=u('<span class="text-gray-400">Saving metadata...</span>'),Jo=u('<div class="mt-4 text-sm bg-amber-900/20 border border-amber-600/30 rounded p-3"><p class="text-amber-300">Finalizing‚Ä¶ You can try downloading now.</p> <button class="btn inline-block mt-2"> </button></div>'),Yo=u('<div class="card"><div class="flex items-center justify-between mb-2"><!> <!></div> <!> <!> <div class="h-3 bg-gray-800 rounded"><div class="h-3 bg-indigo-600 rounded"></div></div> <div class="mt-2 text-xs text-gray-400 flex items-center justify-between"><span> <!></span> <!></div> <!> <details class="mt-3"><summary class="cursor-pointer">FFmpeg log</summary> <pre class="mt-2 text-xs whitespace-pre-wrap"> </pre></details></div>'),Ro=u('<p class="text-sm opacity-70">History tracking is disabled. Enable it in Settings.</p>'),Xo=u('<p class="text-sm opacity-70">No history yet.</p>'),el=u('<li class="flex items-center justify-between gap-2"><span class="truncate"> </span> <div class="flex items-center gap-3"><span class="opacity-70"> </span> <a class="text-blue-400 underline" title="Download">‚¨áÔ∏è</a></div></li>'),al=u('<ul class="text-sm space-y-2"></ul>'),tl=u(`<div id="support-popover" class="fixed bottom-16 right-4 w-64 bg-gray-900/95 text-gray-100 border border-gray-700 rounded-lg shadow-xl p-3 z-50" role="dialog" aria-label="Support the project"><div class="flex items-start justify-between gap-2"><p class="text-xs leading-relaxed">Thanks for using <span class="font-semibold">8mb.local</span>! If this saved you time and you'd like to chip in, tips are appreciated (never expected).</p> <button class="text-gray-400 hover:text-gray-200 text-sm" title="Close" aria-label="Close">√ó</button></div> <div class="mt-2"><a class="underline text-xs hover:text-rose-300" href="https://paypal.me/jasonselsley" target="_blank" rel="noopener noreferrer">paypal.me/jasonselsley</a></div></div>`),sl=u("<div> </div>"),rl=u("<div> <!></div>"),ol=u("<div>Starting‚Ä¶</div>"),ll=u('<div class="fixed bottom-20 right-4 z-40 pointer-events-none"><div class="pointer-events-auto bg-gray-900/95 border border-gray-700 rounded-lg p-3 shadow-xl flex items-center gap-3"><div class="h-5 w-5 rounded-full border-2 border-gray-600 border-t-indigo-500 animate-spin"></div> <div class="text-sm"><!></div></div></div>'),nl=u(`<div class="max-w-3xl mx-auto mt-8 space-y-6"><div class="flex items-center justify-between mb-4"><h1 class="text-2xl font-bold">8mb.local <!></h1> <div class="flex gap-2"><a href="/queue" class="px-4 py-2 bg-blue-700 hover:bg-blue-600 text-white rounded-lg transition-colors text-sm">üìã Queue</a> <a href="/settings" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors text-sm">‚öôÔ∏è Settings</a></div></div> <div class="card"><div class="grid sm:grid-cols-2 gap-4"><div><h3 class="font-semibold mb-2">System</h3> <!></div> <div><h3 class="font-semibold mb-2">GPUs</h3> <!> <!></div></div></div> <div class="card"><div class="border-2 border-dashed border-gray-700 rounded p-8 text-center"><p class="mb-2">Drag & drop a video here</p> <input type="file" accept="video/*"/> <!> <!></div></div> <div class="card grid grid-cols-2 gap-4"><div class="space-x-2 flex flex-wrap gap-2"></div> <div class="flex items-center gap-2 justify-end"><label class="text-sm">Custom size (MB)</label> <input class="input w-28" type="number" min="1"/></div></div> <div class="card grid sm:grid-cols-3 gap-4"><div><label class="block mb-1 text-sm">Video Codec</label> <select class="input w-full codec-select svelte-1uha8ag"></select> <!></div> <div><label class="block mb-1 text-sm">Speed/Quality</label> <select class="input w-full"><option>Fast (P1)</option><option>Balanced (P5)</option><option>Best Quality (P7)</option><option>Default (P6)</option><option>üåü Extra Quality (Slowest)</option></select></div> <div><label class="block mb-1 text-sm">Profile</label> <select class="input w-full"></select></div></div> <div class="card"><details><summary class="cursor-pointer">Advanced Options</summary> <div class="mt-4 grid sm:grid-cols-4 gap-4"><div><label class="block mb-1 text-sm">Audio Codec</label> <select class="input w-full"><option>Opus (Default)</option><option>AAC</option><option>üîá None (Mute)</option></select></div> <div><label class="block mb-1 text-sm">Container</label> <select class="input w-full"><option>MP4 (Most compatible)</option><option>MKV (Best with Opus)</option></select></div> <div><label class="block mb-1 text-sm">Audio Bitrate (kbps)</label> <select class="input w-full"><option>32</option><option>48</option><option>64</option><option>96</option><option>128</option><option>160</option><option>192</option><option>256</option></select> <!></div> <div><label class="block mb-1 text-sm flex items-center gap-1">Tune <span class="text-[11px] opacity-70">(what to prioritize)</span></label> <select class="input w-full" title="Tune tells the encoder what to optimize for."><option>Best Quality (HQ)</option><option>Low Latency (faster)</option><option>Ultra‚ÄëLow Latency (fastest)</option><option>Lossless (no quality loss)</option></select> <p class="mt-1 text-xs opacity-70">Quality = best visuals. Low/Ultra‚Äëlow latency = faster encodes (good for screen/streams). Lossless = huge files.</p></div></div> <div class="mt-4 pt-4 border-t border-gray-700"><h4 class="text-sm font-medium mb-3">Resolution & Trimming</h4> <div class="grid sm:grid-cols-4 gap-4"><div><label class="block mb-1 text-sm">Max Width (px)</label> <input class="input w-full" type="number" placeholder="Original" min="1"/></div> <div><label class="block mb-1 text-sm">Max Height (px)</label> <input class="input w-full" type="number" placeholder="Original" min="1"/></div> <div><label class="block mb-1 text-sm">Start Time</label> <input class="input w-full" type="text" placeholder="0 or 00:00:00"/> <p class="mt-1 text-xs opacity-70">Format: seconds or HH:MM:SS</p></div> <div><label class="block mb-1 text-sm">End Time</label> <input class="input w-full" type="text" placeholder="Full duration"/> <p class="mt-1 text-xs opacity-70">Format: seconds or HH:MM:SS</p></div></div> <p class="mt-2 text-xs opacity-70">Leave resolution blank to keep original. Aspect ratio is maintained.
          Leave times blank to use full duration.</p></div> <div class="mt-4 pt-4 border-t border-gray-700"><h4 class="text-sm font-medium mb-3">UI Options</h4> <div class="flex flex-wrap gap-4"><label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" class="w-4 h-4"/> <span class="text-sm">üîî Play sound when done</span></label> <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" class="w-4 h-4"/> <span class="text-sm">‚¨áÔ∏è Auto-download when done</span></label> <label class="flex items-center gap-2 cursor-pointer" title="Automatically reduce audio bitrate when target size is tight to preserve minimum video quality."><input type="checkbox" class="w-4 h-4"/> <span class="text-sm">üéöÔ∏è Auto audio bitrate</span></label> <!> <label class="flex items-center gap-2 cursor-pointer" title="When enabled, the decoder will try to use GPU hardware decoding whenever possible."><input type="checkbox" class="w-4 h-4"/> <span class="text-sm">‚ö° Force hardware decoding</span></label></div></div> <!></details></div> <!> <!> <div class="flex gap-2"><button class="btn"><!></button> <button class="btn"><!></button> <!> <button class="btn">Reset</button></div> <!> <!> <div class="card"><div class="flex items-center justify-between mb-2"><h3 class="font-semibold">Recent History</h3> <a href="/history" class="text-sm text-blue-400 underline">View all ‚Üí</a></div> <!></div></div> <button class="fixed bottom-4 right-4 bg-gray-800/90 hover:bg-gray-700 text-xs px-3 py-1.5 rounded-full shadow-lg border border-gray-700 backdrop-blur-sm flex items-center gap-1 z-50" aria-controls="support-popover" title="Support the project"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-rose-400"><path d="M11.645 20.91l-.007-.003-.022-.01a15.247 15.247 0 01-.383-.184 25.18 25.18 0 01-4.244-2.62C4.688 16.197 2.25 13.614 2.25 10.5 2.25 8.014 4.237 6 6.75 6c1.56 0 2.927.802 3.75 2.016C11.323 6.802 12.69 6 14.25 6 16.763 6 18.75 8.014 18.75 10.5c0 3.114-2.438 5.697-4.739 7.593a25.175 25.175 0 01-4.244 2.62 15.247 15.247 0 01-.383.184l-.022.01-.007.003-.003.001a.75.75 0 01-.614 0l-.003-.001z"></path></svg> <span>Support</span> <span class="sr-only">the project</span></button> <!> <!>`,1);function xl(A,he){zr(he,!1);const F=f(),U=f(),O=f();let G=f(null),ue=f(null),Q=null,fe=f(!1),J=f(25),Be=f("av1_nvenc"),Y=f("libopus"),He=f("p6"),le=f(128),_e=f(!0),va=f(128),Je=f(null),ye=f("mp4"),Le=f("hq"),wa=f(!0),Aa=f(!0),ka=f(null),Sa=f(null),Ye=f(""),Re=f(""),ze=f(!0),De=f(!0),je=f(null);function Mt(a){if(!a||a.trim()==="")return null;const s=a.trim();if(s.includes(":")){const p=s.split(":").map(c=>parseFloat(c));if(p.length===3)return p[0]*3600+p[1]*60+p[2];if(p.length===2)return p[0]*60+p[1]}const r=parseFloat(s);return isNaN(r)?null:r}let D=f(null),j=f(null),Z=f(0),q=f(0),S=f([]),ae=f(null),T=f(!1),C=null,re=f(null),Se=f(!1),Xe=f(0),ea=f(!1),Pe=f(!1),zt=null,Pa=f(!1),da=f(!1),Dt=f(null),aa=f(null),me=f(null),Ie=f(null),Te=f(!1),pa=f(null),K=f(null),ne=f(!1),Ca=f(!1),Ma=f(""),de=f(null),ta=f(!1);function ws(){t(ta,!e(ta))}function jt(){t(ta,!1)}const As=a=>{a.key==="Escape"&&jt()};let za=f(null),ua=f([]),R=f("cpu"),H=f(null),Da=f(null),ja=f(null),Ia=f(!1),sa=f([]),Ee=f(null),It=f([4,5,8,9.7,50,100]),fa=f([]),Tt=f(!1);Mr(async()=>{var a,s,r,p;try{const c=localStorage.getItem("playSoundWhenDone");c!==null&&t(ze,c==="true");const d=localStorage.getItem("autoDownload");d!==null&&t(De,d==="true"),d===null&&localStorage.setItem("autoDownload","true");const o=localStorage.getItem("autoAudioBitrate");o!==null&&t(_e,o==="true"),o===null&&localStorage.setItem("autoAudioBitrate","true")}catch{}try{const c=await fetch("/api/settings/presets");if(c.ok){const d=await c.json();t(J,d.target_mb),t(Be,d.video_codec),t(Y,d.audio_codec),t(He,d.preset),t(le,d.audio_kbps),t(ye,d.container),t(Le,d.tune)}}catch{console.warn("Failed to load default presets, using hardcoded defaults")}try{const c=await Lr();t(R,c.hardware_type||"cpu"),t(ua,ks(c))}catch{console.warn("Failed to load available codecs, using fallback"),t(ua,[{value:"libx264",label:"H.264 (CPU)",group:"cpu"},{value:"libx265",label:"HEVC (H.265, CPU)",group:"cpu"},{value:"libaom-av1",label:"AV1 (CPU)",group:"cpu"}])}try{t(H,await Nr());const c=(s=(a=e(H))==null?void 0:a.hardware)==null?void 0:s.type;c&&t(R,c)}catch(c){t(Da,(c==null?void 0:c.message)||"Failed to fetch system capabilities")}try{const c=await Ur();t(Ia,!!(c!=null&&c.any_hardware_passed)),t(ja,(c==null?void 0:c.results)||[])}catch{}try{const c=await Gr();t(za,(c==null?void 0:c.version)||null)}catch{}try{const c=await Vr();t(sa,c.profiles||[]),t(Ee,c.default||(((r=e(sa)[0])==null?void 0:r.name)??null)),e(Ee)&&Et(e(Ee))}catch{}try{const c=await Kr();(p=c==null?void 0:c.buttons)!=null&&p.length&&t(It,c.buttons)}catch{}try{const c=await fetch("/api/history");if(c.ok){const d=await c.json();t(Tt,!!d.enabled),t(fa,(d.entries||[]).slice(0,5))}}catch{}});function Et(a){const s=e(sa).find(r=>r.name===a);s&&(t(Ee,a),t(J,s.target_mb),t(Y,s.audio_codec),t(He,s.preset),t(le,s.audio_kbps),t(ye,s.container),t(Le,s.tune))}function qt(a){const s=Math.floor(a/3600),r=Math.floor(a%3600/60),p=Math.floor(a%60);return s>0?`${s}:${r.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`:`${r}:${p.toString().padStart(2,"0")}`}function ks(a){const s=[],r=a.enabled_codecs||[],p=[{value:"av1_nvenc",label:"AV1 (NVIDIA - RTX 40/50 series)",group:"nvidia"},{value:"hevc_nvenc",label:"HEVC (H.265, NVIDIA)",group:"nvidia"},{value:"h264_nvenc",label:"H.264 (NVIDIA)",group:"nvidia"},{value:"av1_qsv",label:"AV1 (Intel Arc/QSV)",group:"intel"},{value:"hevc_qsv",label:"HEVC (H.265, Intel QSV)",group:"intel"},{value:"h264_qsv",label:"H.264 (Intel QSV)",group:"intel"},{value:"av1_vaapi",label:"AV1 (VAAPI)",group:"vaapi"},{value:"hevc_vaapi",label:"HEVC (H.265, VAAPI)",group:"vaapi"},{value:"h264_vaapi",label:"H.264 (VAAPI)",group:"vaapi"},{value:"av1_amf",label:"AV1 (AMD AMF)",group:"amd"},{value:"hevc_amf",label:"HEVC (H.265, AMD AMF)",group:"amd"},{value:"h264_amf",label:"H.264 (AMD AMF)",group:"amd"},{value:"libaom-av1",label:"AV1 (CPU - Highest Quality)",group:"cpu"},{value:"libx265",label:"HEVC (H.265, CPU)",group:"cpu"},{value:"libx264",label:"H.264 (CPU)",group:"cpu"}];for(const c of p)r.includes(c.value)&&s.push(c);return s}function Ft(a){switch(a){case"nvidia":return"#22c55e";case"intel":return"#3b82f6";case"amd":return"#f97316";case"vaapi":return"#8b5cf6";case"cpu":return"#6b7280";default:return"#6b7280"}}function Ss(a){switch(a){case"nvidia":return"üü¢";case"intel":return"üîµ";case"amd":return"üü†";case"vaapi":return"üü£";case"cpu":return"‚ö™";default:return"‚ö™"}}function Ot(a){if(a<1024)return`${a} B`;const s=a/1024;if(s<1024)return`${s.toFixed(1)} KB`;const r=s/1024;return r<1024?`${r.toFixed(2)} MB`:`${(r/1024).toFixed(2)} GB`}function Ps(a){t(J,a)}async function Cs(a){var r;if(a.preventDefault(),!a.dataTransfer)return;const s=(r=a.dataTransfer.files)==null?void 0:r[0];s&&(t(G,s),t(Je,Ot(s.size)),setTimeout(()=>_a(),100))}function Ms(a){a.preventDefault()}async function _a(){var a;if(e(G)&&!(e(Se)||e(fe))){if(Q===e(G).name&&((a=e(D))!=null&&a.filename)){t(je,e(O)&&e(O).video_kbps<100?`Warning: Very low video bitrate (${Math.round(e(O).video_kbps)} kbps)`:null);return}t(fe,!0),t(Se,!0),t(Xe,0),t(re,null);try{console.log("Analyzing file...",e(G).name),t(D,await Or(e(G),e(J),e(le),{onProgress:s=>{t(Xe,s)}})),console.log("Analysis complete:",e(D)),Q=e(G).name,t(je,e(O)&&e(O).video_kbps<100?`Warning: Very low video bitrate (${Math.round(e(O).video_kbps)} kbps)`:null)}catch(s){console.error("Analysis failed:",s),t(re,`Analysis failed: ${s.message||s}`)}finally{t(Se,!1),t(fe,!1)}}}async function zs(){if(!e(D)){if(!e(G)){t(re,"Please select a file and analyze first.");return}if(await _a(),!e(D))return}if(!e(T)){t(re,null);try{t(T,!0),t(Pe,!1),zt=null,t(Te,!1),t(ne,!1),t(Dt,Date.now()),t(aa,null),t(me,null),t(Ie,null),t(S,["Starting compression‚Ä¶",...e(S)].slice(0,500));const a={job_id:e(D).job_id,filename:e(D).filename,target_size_mb:e(J),video_codec:e(Be),audio_codec:e(Y),audio_bitrate_kbps:e(le),preset:e(He),container:e(ye),tune:e(Le),force_hw_decode:e(wa),fast_mp4_finalize:e(Aa),max_width:e(ka)||void 0,max_height:e(Sa)||void 0,start_time:e(Ye).trim()||void 0,end_time:e(Re).trim()||void 0};console.log("Starting compression...",a);const{task_id:s}=await Br(a);t(j,s),console.log("üî¥ [DEBUG] About to open SSE for task_id:",s),t(S,["‚úì Job started. Opening progress stream...",...e(S)].slice(0,500));const r=ys(s);console.log("üî¥ [DEBUG] openProgressStream returned:",r),C=r,r.onopen=()=>{console.log("SSE connection opened for task:",s),t(S,["‚úÖ Connected to progress stream",...e(S)].slice(0,500))},r.onmessage=p=>{var c,d;try{const o=JSON.parse(p.data);if(console.log("SSE event:",o.type,o),o.type==="connected"){console.log("SSE connection confirmed, task_id:",o.task_id);return}if(o.type==="ping")return;if(o.type==="progress"){if(t(Z,o.progress),typeof o.eta_seconds=="number"&&isFinite(o.eta_seconds)&&o.eta_seconds>0){t(aa,o.eta_seconds);const b=Math.round(e(aa)),_=Math.floor(b/3600),P=Math.floor(b%3600/60),w=b%60;t(me,_>0?`${_}h ${P}m`:P>0?`${P}m ${w}s`:`${w}s`)}else t(aa,null),t(me,null);typeof o.speed_x=="number"&&isFinite(o.speed_x)&&o.speed_x>0&&t(Ie,o.speed_x),o.progress>=100||o.phase==="done"?(t(Z,100),t(q,100),t(T,!1),t(ne,!1),t(S,["‚úÖ 100% - Waiting for final confirmation...",...e(S)].slice(0,500))):!e(Te)&&o.progress>0&&t(Te,!0),o.phase==="finalizing"||o.progress>=95&&o.progress<100?t(ne,!0):o.phase==="encoding"&&t(ne,!1)}if(o.type==="log"&&o.message){t(S,[o.message,...e(S)].slice(0,500));const b=o.message.match(/speed=([\d.]+)x/);if(b&&t(Ie,parseFloat(b[1])),o.message.includes("hwaccel:")){const _=o.message.match(/hwaccel:\s*(\w+)/);_&&t(pa,_[1])}if(o.message.includes("encoder:")){const _=o.message.match(/encoder:\s*([\w_]+)/);_&&t(K,_[1])}}if(o.type==="done"){console.log("Received done event, completing job"),t(ae,o.stats),t(Z,100),t(q,100),t(T,!1),t(ne,!1),t(Ca,!1),t(Ma,""),t(Pe,!0),t(Te,!1),t(S,["‚úÖ Compression complete!",...e(S)].slice(0,500));try{C==null||C.close(),C=null}catch{}if(e(ze)){const b=new Audio("data:audio/wav;base64,UklGRiQFAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAFAAB/goSGiIqMjo+RkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v+AgYKDhIWGh4iJiouMjY6PkJGSk5SVlpeYmZqbnJ2en6ChoqOkpaanqKmqq6ytrq+wsbKztLW2t7i5uru8vb6/wMHCw8TFxsfIycrLzM3Oz9DR0tPU1dbX2Nna29zd3t/g4eLj5OXm5+jp6uvs7e7v8PHy8/T19vf4+fr7/P3+/4CBgoOEhYaHiImKi4yNjo+QkZKTlJWWl5iZmpucnZ6foKGio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMXGx8jJysvMzc7P0NHS09TV1tfY2drb3N3e3+Dh4uPk5ebn6Onq6+zt7u/w8fLz9PX29/j5+vv8/f7/gIGCg4SFhoeIiYqLjI2Oj5CRkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v8=");b.volume=.4,b.play().catch(()=>{})}e(De)&&e(j)&&setTimeout(()=>{window.location.href=Me(e(j))},500)}if(o.type==="error"){t(S,[`‚ùå Error: ${o.message}`,...e(S)]),t(re,o.message),t(T,!1),t(ne,!1);try{C==null||C.close()}catch{}}if(o.type==="retry"){t(Ca,!0),t(Ma,`File was ${(c=o.overage_percent)==null?void 0:c.toFixed(1)}% over target - Re-encoding with optimized bitrate`),t(S,[`üîÑ RETRY: ${o.message}`,...e(S)].slice(0,500));const b=`‚ö†Ô∏è File too large (${(d=o.overage_percent)==null?void 0:d.toFixed(1)}% over target) - Re-encoding with adjusted bitrate...`;t(S,["‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê","üîÑ AUTOMATIC RETRY IN PROGRESS",b,"This is normal - the system will automatically optimize the output.","‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê",...e(S)].slice(0,500));try{const _=new Audio("data:audio/wav;base64,UklGRiQDAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQADAAB/fn18e3p5eHd2dXRzcnFwb25tbGtqaWhnZmVkY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk1MS0pJSEdGRURDQkFAPz49PDo6OTg3NjU0MzIxMC8uLSwrKikoJyYlJCMiISAfHh0cGxoZGBcWFRQTEhEQDw4NDAsKCQgHBgUEAwIBAACAgYKDhIWGh4iJiouMjY6PkJGSk5SVlpeYmZqbnJ2en6ChoqOkpaanqKmqq6ytrq+wsbKztLW2t7i5uru8vb6/wMHCw8TFxsfIycrLzM3Oz9DR0tPU1dbX2Nna29zd3t/g4eLj5OXm5+jp6uvs7e7v8PHy8/T19vf4+fr7/P3+/4CBgoOEhYaHiImKi4yNjo+QkZKTlJWWl5iZmpucnZ6foKGio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMXGx8jJysvMzc7P0NHS09TV1tfY2drb3N3e3+Dh4uPk5ebn6Onq6+zt7u/w8fLz9PX29/j5+vv8/f7/gIGCg4SFhoeIiYqLjI2Oj5CRkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v8=");_.volume=.3,_.play().catch(()=>{}),setTimeout(()=>{const P=new Audio("data:audio/wav;base64,UklGRiQDAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQADAAB/fn18e3p5eHd2dXRzcnFwb25tbGtqaWhnZmVkY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk1MS0pJSEdGRURDQkFAPz49PDo6OTg3NjU0MzIxMC8uLSwrKikoJyYlJCMiISAfHh0cGxoZGBcWFRQTEhEQDw4NDAsKCQgHBgUEAwIBAACAgYKDhIWGh4iJiouMjY6PkJGSk5SVlpeYmZqbnJ2en6ChoqOkpaanqKmqq6ytrq+wsbKztLW2t7i5uru8vb6/wMHCw8TFxsfIycrLzM3Oz9DR0tPU1dbX2Nna29zd3t/g4eLj5OXm5+jp6uvs7e7v8PHy8/T19vf4+fr7/P3+/4CBgoOEhYaHiImKi4yNjo+QkZKTlJWWl5iZmpucnZ6foKGio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMXGx8jJysvMzc7P0NHS09TV1tfY2drb3N3e3+Dh4uPk5ebn6Onq6+zt7u/w8fLz9PX29/j5+vv8/f7/gIGCg4SFhoeIiYqLjI2Oj5CRkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v8=");P.volume=.3,P.play().catch(()=>{})},250)}catch{}t(q,1),t(Z,1)}if(o.type==="canceled"){t(S,["üö´ Job canceled",...e(S)]),t(T,!1),t(ne,!1);try{C==null||C.close()}catch{}}}catch(o){console.error("Failed to parse SSE message:",o)}},r.onerror=p=>{console.error("SSE error:",p),console.log("SSE readyState:",r.readyState,"taskId:",e(j)),t(S,["‚ö†Ô∏è Progress stream connection issue. Checking queue for updates...",...e(S)].slice(0,500));try{C==null||C.close(),C=null}catch{}!e(ae)&&e(j)&&t(S,['üí° View live progress at: <a href="/queue" class="text-blue-400 underline">/queue</a>',`Task ID: ${e(j)}`,...e(S)].slice(0,500))}}catch(a){console.error("Compress failed:",a),t(re,`Compression failed: ${a.message||a}`),t(T,!1)}}}async function Ds(){if(!e(j))return;t(da,!0);const a=Me(e(j));try{window.location.href=`${a}?wait=2`}finally{setTimeout(()=>{t(da,!1)},1e3)}}function js(){if(!e(j))return;t(re,null);try{C==null||C.close()}catch{}const a=ys(e(j));C=a,t(T,!0),a.onmessage=s=>{try{const r=JSON.parse(s.data);if(r.type==="progress"&&t(Z,r.progress),r.type==="log"&&r.message&&t(S,[r.message,...e(S)].slice(0,500)),r.type==="done"){t(ae,r.stats),t(Z,100),t(T,!1);try{C==null||C.close()}catch{}if(e(ze)){const p=new Audio("data:audio/wav;base64,UklGRiQFAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAFAAB/goSGiIqMjo+RkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v+AgYKDhIWGh4iJiouMjY6PkJGSk5SVlpeYmZqbnJ2en6ChoqOkpaanqKmqq6ytrq+wsbKztLW2t7i5uru8vb6/wMHCw8TFxsfIycrLzM3Oz9DR0tPU1dbX2Nna29zd3t/g4eLj5OXm5+jp6uvs7e7v8PHy8/T19vf4+fr7/P3+/4CBgoOEhYaHiImKi4yNjo+QkZKTlJWWl5iZmpucnZ6foKGio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMXGx8jJysvMzc7P0NHS09TV1tfY2drb3N3e3+Dh4uPk5ebn6Onq6+zt7u/w8fLz9PX29/j5+vv8/f7/gIGCg4SFhoeIiYqLjI2Oj5CRkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v8=");p.volume=.4,p.play().catch(()=>{})}e(De)&&e(j)&&setTimeout(()=>{window.location.href=Me(e(j))},500)}if(r.type==="error"){t(S,[r.message,...e(S)]),t(T,!1);try{C==null||C.close()}catch{}}}catch{}},a.onerror=()=>{t(S,["[SSE] Connection error: lost progress stream.",...e(S)].slice(0,500)),t(re,"Lost connection to progress stream. Check server/network and try again."),t(T,!1);try{C==null||C.close()}catch{}}}function Is(){Q=null,t(D,null),t(j,null),t(Z,0),t(q,0),t(S,[]),t(ae,null),t(je,null),t(re,null),t(Se,!1),t(T,!1),t(ne,!1),t(pa,null),t(K,null),t(Pe,!1),zt=null,t(Pa,!1),e(de)&&(clearInterval(e(de)),t(de,null));try{C==null||C.close()}catch{}}function Ts(){t(G,null),t(Je,null),Q=null,t(D,null),t(je,null),t(re,null);try{e(ue)&&Tr(ue,e(ue).value="")}catch{}}async function Es(){if(!(!e(j)||e(ea))){t(ea,!0);try{await Hr(e(j)),t(S,["Cancellation requested‚Ä¶",...e(S)].slice(0,500))}catch(a){t(re,(a==null?void 0:a.message)||"Failed to cancel")}finally{t(ea,!1)}}}pe(()=>(e(D),e(Ye),e(Re)),()=>{t(F,(()=>{if(!e(D))return 0;const a=e(D).duration_s,s=Mt(e(Ye)),r=Mt(e(Re)),d=Math.max(0,(r!==null?r:a)-(s!==null?s:0));return d>0?d:a})())}),pe(()=>(e(ye),e(Y)),()=>{t(U,e(ye)==="mp4"&&e(Y)==="libopus"?"MP4 does not support Opus; audio will be encoded as AAC automatically.":null)}),pe(()=>(e(_e),e(Y),e(F),e(J),e(va),e(le)),()=>{(async()=>{try{if(!e(_e)||e(Y)==="none")return;const a=e(F);if(!a||a<=0)return;const s=e(J)*8192/a;if(!isFinite(s)||s<=0)return;const r=100,p=[256,192,160,128,96,64,48,32],c=e(va);let d=c;if(s-c<r){const o=Math.max(32,Math.floor(s-r));let b=32;for(const _ of p)if(_<=o&&_<=c){b=_;break}d=b}d!==e(le)&&t(le,d)}catch{}})()}),pe(()=>(e(D),e(F),e(J),e(Y),e(le)),()=>{t(O,e(D)?{duration_s:e(F),total_kbps:e(F)>0?e(J)*8192/e(F):0,video_kbps:e(F)>0?Math.max(e(J)*8192/e(F)-(e(Y)==="none"?0:e(le)),0):0,final_mb:e(J)}:null)}),pe(()=>e(O),()=>{t(je,e(O)&&e(O).video_kbps<100?`Warning: Very low video bitrate (${Math.round(e(O).video_kbps)} kbps)`:null)}),pe(()=>(e(Z),e(q)),()=>{(()=>{if(e(Z)>=100||Math.abs(e(Z)-e(q))>10)t(q,e(Z));else if(e(Z)>e(q)){const a=e(Z)-e(q);if(a>.1){const s=Math.min(a/5,1);t(q,Math.min(e(q)+s,e(Z)))}else t(q,e(Z))}})()}),pe(()=>(e(j),e(q),e(Pe),e(ae),e(T),e(de),Me),()=>{(async()=>{const a=!!e(j)&&e(q)>=99.9&&!e(Pe)&&!e(ae)&&e(T);console.log("[Watchdog] Reactive check - shouldPoll:",a,"displayedProgress:",e(q),"isReady:",e(Pe),"isCompressing:",e(T)),a&&!e(de)?(console.log("[Watchdog] Starting finalization poll for",e(j)),t(de,setInterval(async()=>{var s;if(e(j))try{console.log("[Watchdog] Polling download endpoint...");const r=await fetch(`${Me(e(j))}?wait=2`,{method:"GET",cache:"no-store",redirect:"manual"});if(console.log("[Watchdog] Response status:",r.status,"ok:",r.ok),r.ok&&r.status===200)console.log("[Watchdog] File ready! Auto-downloading..."),t(Pe,!0),t(ne,!1),t(Pa,!1),t(T,!1),clearInterval(e(de)),t(de,null),window.location.href=Me(e(j));else if(r.status===404){const p=await r.json().catch(()=>({}));console.log("[Watchdog] File not ready yet (404):",((s=p.detail)==null?void 0:s.state)||"unknown state")}else console.log("[Watchdog] Unexpected status, will retry...")}catch(r){console.log("[Watchdog] Poll error:",r)}},1e3))):!a&&e(de)&&(console.log("[Watchdog] Stopping finalization poll (shouldPoll=false)"),clearInterval(e(de)),t(de,null))})()}),pe(()=>e(T),()=>{e(T)||(t(Dt,null),t(aa,null),t(me,null),t(Ie,null),t(Te,!1),t(ne,!1))}),pe(()=>e(ze),()=>{(()=>{try{localStorage.setItem("playSoundWhenDone",String(e(ze)))}catch{}})()}),pe(()=>e(De),()=>{(()=>{try{localStorage.setItem("autoDownload",String(e(De)))}catch{}})()}),pe(()=>e(_e),()=>{(()=>{try{localStorage.setItem("autoAudioBitrate",String(e(_e)))}catch{}})()}),Dr(),qr();var Bt=nl(),Ta=N(Bt),Ea=i(Ta),Ht=i(Ea),qs=n(i(Ht));{var Fs=a=>{var s=Wr(),r=i(s);l(s),h(()=>y(r,`v${e(za)??""}`)),v(a,s)};g(qs,a=>{e(za)&&a(Fs)})}l(Ht),ee(2),l(Ea);var qa=n(Ea,2),Lt=i(qa),Fa=i(Lt),Os=n(i(Fa),2);{var Bs=a=>{var s=Jr(),r=N(s),p=i(r);l(r);var c=n(r,2),d=i(c);l(c);var o=n(c,2),b=n(i(o)),_=i(b),P=n(_,1,!0);l(b),l(o);var w=n(o,2),z=i(w);{var B=L=>{var V=se(),M=N(V);{var oe=ie=>{var Ae=Qr();v(ie,Ae)},we=ie=>{var Ae=Zr();v(ie,Ae)};g(M,ie=>{e(Ia)?ie(oe):ie(we,!1)})}v(L,V)},X=L=>{var V=$r();v(L,V)};g(z,L=>{e(R)!=="cpu"?L(B):L(X,!1)})}l(w),h((L,V)=>{y(p,`CPU: ${e(H),m(()=>{var M;return((M=e(H).cpu)==null?void 0:M.model)||"Unknown"})??""} (${e(H),m(()=>{var M;return(M=e(H).cpu)==null?void 0:M.cores_physical})??""}C/${e(H),m(()=>{var M;return(M=e(H).cpu)==null?void 0:M.cores_logical})??""}T)`),y(d,`Memory: ${e(H),m(()=>{var M;return(M=e(H).memory)==null?void 0:M.available_gb})??""} GB free / ${e(H),m(()=>{var M;return(M=e(H).memory)==null?void 0:M.total_gb})??""} GB`),ya(_,L),y(P,V)},[()=>(e(R),m(()=>`background-color:${Ft(e(R))}`)),()=>(e(R),m(()=>e(R).toUpperCase()))]),v(a,s)},Hs=a=>{var s=se(),r=N(s);{var p=d=>{var o=Yr(),b=i(o,!0);l(o),h(()=>y(b,e(Da))),v(d,o)},c=d=>{var o=Rr();v(d,o)};g(r,d=>{e(Da)?d(p):d(c,!1)},!0)}v(a,s)};g(Os,a=>{e(H)?a(Bs):a(Hs,!1)})}l(Fa);var Nt=n(Fa,2),Ut=n(i(Nt),2);{var Ls=a=>{var s=ao(),r=N(s);Qe(r,5,()=>(e(H),m(()=>e(H).gpus)),Ze,(d,o)=>{var b=Xr(),_=i(b);l(b),h(()=>y(_,`#${e(o),m(()=>e(o).index)??""} ${e(o),m(()=>e(o).name)??""} ‚Äî ${e(o),m(()=>e(o).memory_used_gb)??""}/${e(o),m(()=>e(o).memory_total_gb)??""} GB`)),v(d,b)}),l(r);var p=n(r,2);{var c=d=>{var o=eo(),b=i(o);l(o),h(()=>y(b,`NVIDIA Driver: ${e(H),m(()=>e(H).nvidia_driver)??""}`)),v(d,o)};g(p,d=>{e(H),m(()=>e(H).nvidia_driver)&&d(c)})}v(a,s)},Ns=a=>{var s=to();v(a,s)};g(Ut,a=>{e(H),m(()=>{var s,r;return(r=(s=e(H))==null?void 0:s.gpus)==null?void 0:r.length})?a(Ls):a(Ns,!1)})}var Us=n(Ut,2);{var Gs=a=>{var s=uo(),r=n(i(s),2);Qe(r,5,()=>e(ja),Ze,(d,o)=>{var b=vo(),_=i(b),P=i(_),w=i(P),z=n(w),B=i(z);l(z),l(P);var X=n(P,2);{var L=I=>{var E=so();v(I,E)},V=I=>{var E=ro();v(I,E)};g(X,I=>{e(o),m(()=>e(o).passed)?I(L):I(V,!1)})}l(_);var M=n(_,2);{var oe=I=>{var E=no(),ke=n(i(E),2);{var Ue=ge=>{var x=oo(),k=i(x);l(x),h(()=>y(k,`‚úì ${e(o),m(()=>e(o).decode_message||"OK")??""}`)),v(ge,x)},Ce=ge=>{var x=lo(),k=i(x);l(x),h(()=>{$e(x,"title",(e(o),m(()=>e(o).decode_message||"Failed"))),y(k,`‚úó ${e(o),m(()=>e(o).decode_message||"Failed")??""}`)}),v(ge,x)};g(ke,ge=>{e(o),m(()=>e(o).decode_passed===!0)?ge(Ue):ge(Ce,!1)})}l(E),v(I,E)};g(M,I=>{e(o),m(()=>e(o).decode_passed!==null&&e(o).decode_passed!==void 0)&&I(oe)})}var we=n(M,2),ie=n(i(we),2);{var Ae=I=>{var E=io(),ke=i(E);l(E),h(()=>y(ke,`‚úì ${e(o),m(()=>e(o).encode_message||"OK")??""}`)),v(I,E)},la=I=>{var E=co(),ke=i(E);l(E),h(()=>{$e(E,"title",(e(o),m(()=>e(o).encode_message||"Failed"))),y(ke,`‚úó ${e(o),m(()=>e(o).encode_message||"Failed")??""}`)}),v(I,E)};g(ie,I=>{e(o),m(()=>e(o).encode_passed===!0)?I(Ae):I(la,!1)})}l(we),l(b),h(()=>{y(w,`${e(o),m(()=>e(o).codec)??""} `),y(B,`(${e(o),m(()=>e(o).actual_encoder)??""})`)}),v(d,b)}),l(r);var p=n(r,2);{var c=d=>{var o=po();v(d,o)};g(p,d=>{!e(Ia)&&e(R)!=="cpu"&&d(c)})}l(s),v(a,s)};g(Us,a=>{e(ja)&&a(Gs)})}l(Nt),l(Lt),l(qa);var Oa=n(qa,2),ma=i(Oa),Ba=n(i(ma),2);Er(Ba,a=>t(ue,a),()=>e(ue));var Gt=n(Ba,2);{var Vs=a=>{var s=_o(),r=i(s),p=i(r),c=n(p);{var d=b=>{var _=fo(),P=i(_);l(_),h(()=>y(P,`‚Ä¢ ${e(Je)??""}`)),v(b,_)};g(c,b=>{e(Je)&&b(d)})}l(r);var o=n(r,2);l(s),h(()=>y(p,`${e(G),m(()=>e(G).name)??""} `)),$("click",o,Ts),v(a,s)};g(Gt,a=>{e(G)&&a(Vs)})}var Ks=n(Gt,2);{var Ws=a=>{var s=mo(),r=i(s),p=i(r);l(r);var c=n(r,2),d=i(c);l(c),ee(2),l(s),h(()=>{y(p,`Analyzing video‚Ä¶ ${e(Xe)??""}%`),ya(d,`width:${e(Xe)}%`)}),v(a,s)};g(Ks,a=>{e(Se)&&a(Ws)})}l(ma),l(Oa);var Ha=n(Oa,2),La=i(Ha);Qe(La,5,()=>e(It),Ze,(a,s)=>{var r=go(),p=i(r);l(r),h(()=>y(p,`${e(s)??""}MB`)),$("click",r,()=>Ps(e(s))),v(a,r)}),l(La);var Vt=n(La,2),Kt=n(i(Vt),2);xe(Kt),l(Vt),l(Ha);var Na=n(Ha,2),Ua=i(Na),ga=n(i(Ua),2);h(()=>{e(Be),Fe(()=>{e(ua)})}),Qe(ga,5,()=>e(ua),Ze,(a,s)=>{var r=bo(),p=i(r);l(r);var c={};h(d=>{$e(r,"data-group",(e(s),m(()=>e(s).group))),y(p,`${d??""} ${e(s),m(()=>e(s).label)??""}`),c!==(c=(e(s),m(()=>e(s).value)))&&(r.value=(r.__value=(e(s),m(()=>e(s).value)))??"")},[()=>(e(s),m(()=>Ss(e(s).group)))]),v(a,r)}),l(ga);var Qs=n(ga,2);{var Zs=a=>{var s=xo(),r=i(s),p=n(r);l(s),h((c,d)=>{ya(r,`background-color: ${c??""}`),y(p,` Detected: ${d??""} acceleration`)},[()=>(e(R),m(()=>Ft(e(R)))),()=>(e(R),m(()=>e(R).toUpperCase()))]),v(a,s)},$s=a=>{var s=ho();v(a,s)};g(Qs,a=>{e(R)!=="cpu"?a(Zs):a($s,!1)})}l(Ua);var Ga=n(Ua,2),Va=n(i(Ga),2);h(()=>{e(He),Fe(()=>{})});var Ka=i(Va);Ka.value=Ka.__value="p1";var Wa=n(Ka);Wa.value=Wa.__value="p5";var Qa=n(Wa);Qa.value=Qa.__value="p7";var Za=n(Qa);Za.value=Za.__value="p6";var Wt=n(Za);Wt.value=Wt.__value="extraquality",l(Va),l(Ga);var Qt=n(Ga,2),ba=n(i(Qt),2);h(()=>{e(Ee),Fe(()=>{e(sa)})}),Qe(ba,5,()=>e(sa),Ze,(a,s)=>{var r=yo(),p=i(r,!0);l(r);var c={};h(()=>{y(p,(e(s),m(()=>e(s).name))),c!==(c=(e(s),m(()=>e(s).name)))&&(r.value=(r.__value=(e(s),m(()=>e(s).name)))??"")}),v(a,r)}),l(ba),l(Qt),l(Na);var $a=n(Na,2),Zt=i($a),Ja=n(i(Zt),2),Ya=i(Ja),Ra=n(i(Ya),2);h(()=>{e(Y),Fe(()=>{})});var Xa=i(Ra);Xa.value=Xa.__value="libopus";var et=n(Xa);et.value=et.__value="aac";var $t=n(et);$t.value=$t.__value="none",l(Ra),l(Ya);var at=n(Ya,2),tt=n(i(at),2);h(()=>{e(ye),Fe(()=>{})});var st=i(tt);st.value=st.__value="mp4";var Jt=n(st);Jt.value=Jt.__value="mkv",l(tt),l(at);var rt=n(at,2),Ne=n(i(rt),2);h(()=>{e(le),Fe(()=>{e(Y),e(_e),e(va)})});var ot=i(Ne);ot.value=ot.__value=32;var lt=n(ot);lt.value=lt.__value=48;var nt=n(lt);nt.value=nt.__value=64;var it=n(nt);it.value=it.__value=96;var ct=n(it);ct.value=ct.__value=128;var vt=n(ct);vt.value=vt.__value=160;var dt=n(vt);dt.value=dt.__value=192;var Yt=n(dt);Yt.value=Yt.__value=256,l(Ne);var Js=n(Ne,2);{var Ys=a=>{var s=wo();v(a,s)},Rs=a=>{var s=se(),r=N(s);{var p=c=>{var d=Ao();v(c,d)};g(r,c=>{e(_e)&&c(p)},!0)}v(a,s)};g(Js,a=>{e(Y)==="none"?a(Ys):a(Rs,!1)})}l(rt);var Rt=n(rt,2),pt=n(i(Rt),2);h(()=>{e(Le),Fe(()=>{})});var ut=i(pt);ut.value=ut.__value="hq";var ft=n(ut);ft.value=ft.__value="ll";var _t=n(ft);_t.value=_t.__value="ull";var Xt=n(_t);Xt.value=Xt.__value="lossless",l(pt),ee(2),l(Rt),l(Ja);var mt=n(Ja,2),es=n(i(mt),2),gt=i(es),as=n(i(gt),2);xe(as),l(gt);var bt=n(gt,2),ts=n(i(bt),2);xe(ts),l(bt);var xt=n(bt,2),ss=n(i(xt),2);xe(ss),ee(2),l(xt);var rs=n(xt,2),os=n(i(rs),2);xe(os),ee(2),l(rs),l(es),ee(2),l(mt);var ht=n(mt,2),ls=n(i(ht),2),yt=i(ls),ns=i(yt);xe(ns),ee(2),l(yt);var wt=n(yt,2),is=i(wt);xe(is),ee(2),l(wt);var At=n(wt,2),cs=i(At);xe(cs),ee(2),l(At);var vs=n(At,2);{var Xs=a=>{var s=ko(),r=i(s);xe(r),ee(2),l(s),ca(r,()=>e(Aa),p=>t(Aa,p)),v(a,s)};g(vs,a=>{e(ye)==="mp4"&&a(Xs)})}var ds=n(vs,2),ps=i(ds);xe(ps),ee(2),l(ds),l(ls),l(ht);var er=n(ht,2);{var ar=a=>{var s=So(),r=i(s,!0);l(s),h(()=>y(r,e(U))),v(a,s)};g(er,a=>{e(U)&&a(ar)})}l(Zt),l($a);var us=n($a,2);{var tr=a=>{var s=zo(),r=i(s),p=i(r);{var c=w=>{var z=Po(),B=N(z),X=i(B);l(B),ee(2),h((L,V)=>y(X,`Duration: ${L??""} (trimmed from ${V??""})`),[()=>(e(F),m(()=>qt(e(F)))),()=>(e(D),m(()=>qt(e(D).duration_s)))]),v(w,z)};g(p,w=>{e(F),e(D),m(()=>e(F)!==e(D).duration_s)&&w(c)})}var d=n(p);l(r);var o=n(r,2);{var b=w=>{var z=Co(),B=i(z);l(z),h(X=>y(B,`Estimated final size: ~${X??""} MB`),[()=>(e(O),m(()=>e(O).final_mb.toFixed(2)))]),v(w,z)};g(o,w=>{e(O)&&w(b)})}var _=n(o,2);{var P=w=>{var z=Mo(),B=i(z,!0);l(z),h(()=>y(B,e(je))),v(w,z)};g(_,w=>{e(je)&&w(P)})}l(s),h((w,z,B)=>y(d,` Original: ${w??""} kbps
        Target: ${z??""} kbps -> Video ~${B??""} kbps`),[()=>(e(D),m(()=>Math.round((e(D).original_video_bitrate_kbps||0)+(e(D).original_audio_bitrate_kbps||0)))),()=>(e(O),e(D),m(()=>e(O)?Math.round(e(O).total_kbps):Math.round(e(D).estimate_total_kbps))),()=>(e(O),e(D),m(()=>e(O)?Math.round(e(O).video_kbps):Math.round(e(D).estimate_video_kbps)))]),v(a,s)};g(us,a=>{e(D)&&a(tr)})}var fs=n(us,2);{var sr=a=>{var s=jo(),r=i(s),p=i(r,!0);l(r);var c=n(r,2);{var d=o=>{var b=Do(),_=i(b);ee(2),l(b),$("click",_,js),v(o,b)};g(c,o=>{e(j)&&!e(ae)&&o(d)})}l(s),h(()=>y(p,e(re))),v(a,s)};g(fs,a=>{e(re)&&a(sr)})}var kt=n(fs,2),ra=i(kt),rr=i(ra);{var or=a=>{var s=qe("Re-analyze");v(a,s)},lr=a=>{var s=qe("Analyze");v(a,s)};g(rr,a=>{e(D)?a(or):a(lr,!1)})}l(ra);var oa=n(ra,2),nr=i(oa);{var ir=a=>{var s=se(),r=N(s);{var p=d=>{var o=Io(),b=N(o),_=n(b);{var P=w=>{var z=qe();h(()=>y(z,`‚Äî ~${e(me)??""} left`)),v(w,z)};g(_,w=>{e(me)&&w(P)})}h(()=>y(b,`Compressing‚Ä¶ ${e(Z)??""}%`)),v(d,o)},c=d=>{var o=qe("Starting‚Ä¶");v(d,o)};g(r,d=>{e(Te)?d(p):d(c,!1)})}v(a,s)},cr=a=>{var s=qe("Compress");v(a,s)};g(nr,a=>{e(T)?a(ir):a(cr,!1)})}l(oa);var _s=n(oa,2);{var vr=a=>{var s=To(),r=i(s,!0);l(s),h(()=>{s.disabled=e(ea),y(r,e(ea)?"Canceling‚Ä¶":"Cancel")}),$("click",s,Es),v(a,s)};g(_s,a=>{e(j)&&e(T)&&a(vr)})}var ms=n(_s,2);l(kt);var gs=n(kt,2);{var dr=a=>{var s=Fo(),r=i(s),p=i(r),c=n(i(p),2);{var d=_=>{var P=Eo(),w=n(i(P)),z=i(w);l(w),l(P),h(()=>y(z,`${e(ae),m(()=>e(ae).final_size_mb)??""} MB`)),v(_,P)},o=_=>{var P=qo();v(_,P)};g(c,_=>{e(ae)?_(d):_(o,!1)})}l(p);var b=n(p,2);l(r),l(s),h(_=>$e(b,"href",_),[()=>(Ir(Me),e(j),m(()=>Me(e(j))))]),v(a,s)};g(gs,a=>{e(j)&&e(ae)&&a(dr)})}var bs=n(gs,2);{var pr=a=>{var s=Yo(),r=i(s),p=i(r);{var c=x=>{var k=Oo(),W=i(k);l(k),h(()=>y(W,`Pipeline: ${(e(pa)||"auto")??""} ‚Üí ${(e(K)||e(Be)||"auto")??""}`)),v(x,k)};g(p,x=>{(e(pa)||e(K))&&x(c)})}var d=n(p,2);{var o=x=>{var k=se(),W=N(k);{var be=te=>{var Ge=Bo();v(te,Ge)},ce=te=>{var Ge=se(),Pt=N(Ge);{var xr=Ve=>{var xa=Ho();v(Ve,xa)},hr=Ve=>{var xa=se(),yr=N(xa);{var wr=Ke=>{var ha=Lo();v(Ke,ha)},Ar=Ke=>{var ha=se(),kr=N(ha);{var Sr=We=>{var na=No();v(We,na)},Pr=We=>{var na=Uo(),Cr=i(na);l(na),h(()=>y(Cr,`Encoder: CPU (${e(K)??""})`)),v(We,na)};g(kr,We=>{e(K),m(()=>/_vaapi$/.test(e(K)))?We(Sr):We(Pr,!1)},!0)}v(Ke,ha)};g(yr,Ke=>{e(K),m(()=>/_amf$/.test(e(K)))?Ke(wr):Ke(Ar,!1)},!0)}v(Ve,xa)};g(Pt,Ve=>{e(K),m(()=>/_qsv$/.test(e(K)))?Ve(xr):Ve(hr,!1)},!0)}v(te,Ge)};g(W,te=>{e(K),m(()=>/_nvenc$/.test(e(K)))?te(be):te(ce,!1)})}v(x,k)},b=x=>{var k=Go();v(x,k)};g(d,x=>{e(K)?x(o):x(b,!1)})}l(r);var _=n(r,2);{var P=x=>{var k=Vo();v(x,k)};g(_,x=>{e(K),e(R),m(()=>e(K)&&e(K).startsWith("lib")&&e(R)!=="cpu")&&x(P)})}var w=n(_,2);{var z=x=>{var k=Ko(),W=i(k),be=n(i(W),2),ce=n(i(be),2),te=i(ce,!0);l(ce),ee(2),l(be),l(W),l(k),h(()=>y(te,e(Ma))),v(x,k)};g(w,x=>{e(Ca)&&x(z)})}var B=n(w,2),X=i(B);l(B);var L=n(B,2),V=i(L),M=i(V),oe=n(M);{var we=x=>{var k=Wo();v(x,k)},ie=x=>{var k=se(),W=N(k);{var be=ce=>{var te=Qo(),Ge=i(te);l(te),h(Pt=>y(Ge,`‚Ä¢ ${Pt??""}x`),[()=>(e(Ie),m(()=>e(Ie).toFixed(2)))]),v(ce,te)};g(W,ce=>{e(Ie)&&e(q)<95&&ce(be)},!0)}v(x,k)};g(oe,x=>{e(T)&&e(ne)&&!e(ae)?x(we):x(ie,!1)})}l(V);var Ae=n(V,2);{var la=x=>{var k=Zo(),W=i(k);l(k),h(()=>y(W,`~${e(me)??""} remaining`)),v(x,k)},I=x=>{var k=se(),W=N(k);{var be=ce=>{var te=$o();v(ce,te)};g(W,ce=>{e(T)&&e(ne)&&!e(ae)&&ce(be)},!0)}v(x,k)};g(Ae,x=>{e(T)&&e(q)<99&&e(me)?x(la):x(I,!1)})}l(L);var E=n(L,2);{var ke=x=>{var k=Jo(),W=n(i(k),2),be=i(W,!0);l(W),l(k),h(()=>{W.disabled=e(da),y(be,e(da)?"Trying‚Ä¶":"Try Download")}),$("click",W,Ds),v(x,k)};g(E,x=>{!e(Pe)&&!e(ae)&&e(Pa)&&x(ke)})}var Ue=n(E,2),Ce=n(i(Ue),2),ge=i(Ce,!0);l(Ce),l(Ue),l(s),h((x,k)=>{ya(X,`width:${e(q)}%`),y(M,`${x??""}% `),y(ge,k)},[()=>(e(q),m(()=>e(q).toFixed(1))),()=>(e(S),m(()=>e(S).join(`
`)))]),v(a,s)};g(bs,a=>{e(j)&&a(pr)})}var xs=n(bs,2),ur=n(i(xs),2);{var fr=a=>{var s=Ro();v(a,s)},_r=a=>{var s=se(),r=N(s);{var p=d=>{var o=Xo();v(d,o)},c=d=>{var o=al();Qe(o,5,()=>e(fa),Ze,(b,_)=>{var P=el(),w=i(P),z=i(w,!0);l(w);var B=n(w,2),X=i(B),L=i(X);l(X);var V=n(X,2);l(B),l(P),h((M,oe)=>{y(z,(e(_),m(()=>e(_).filename))),y(L,`${M??""} MB`),$e(V,"href",oe)},[()=>(e(_),m(()=>e(_).compressed_size_mb.toFixed(2))),()=>(e(_),m(()=>`/api/jobs/${encodeURIComponent(e(_).task_id)}/download`))]),v(b,P)}),l(o),v(d,o)};g(r,d=>{e(fa),m(()=>e(fa).length===0)?d(p):d(c,!1)},!0)}v(a,s)};g(ur,a=>{e(Tt)?a(_r,!1):a(fr)})}l(xs),l(Ta);var St=n(Ta,2),hs=n(St,2);{var mr=a=>{var s=tl(),r=i(s),p=n(i(r),2);l(r),ee(2),l(s),$("click",p,jt),$("keydown",s,As),v(a,s)};g(hs,a=>{e(ta)&&a(mr)})}var gr=n(hs,2);{var br=a=>{var s=ll(),r=i(s),p=n(i(r),2),c=i(p);{var d=b=>{var _=sl(),P=i(_);l(_),h(()=>y(P,`Uploading‚Ä¶ ${e(Xe)??""}%`)),v(b,_)},o=b=>{var _=se(),P=N(_);{var w=z=>{var B=se(),X=N(B);{var L=M=>{var oe=rl(),we=i(oe),ie=n(we);{var Ae=I=>{var E=qe();h(()=>y(E,`‚Äî ~${e(me)??""} left`)),v(I,E)},la=I=>{var E=se(),ke=N(E);{var Ue=Ce=>{var ge=qe("‚Äî finalizing‚Ä¶");v(Ce,ge)};g(ke,Ce=>{e(q)>=99&&Ce(Ue)},!0)}v(I,E)};g(ie,I=>{e(q)<99&&e(me)?I(Ae):I(la,!1)})}l(oe),h(I=>y(we,`Compressing‚Ä¶ ${I??""}% `),[()=>(e(q),m(()=>e(q).toFixed(1)))]),v(M,oe)},V=M=>{var oe=ol();v(M,oe)};g(X,M=>{e(Te)?M(L):M(V,!1)})}v(z,B)};g(P,z=>{e(T)&&z(w)},!0)}v(b,_)};g(c,b=>{e(Se)?b(d):b(o,!1)})}l(p),l(r),l(s),v(a,s)};g(gr,a=>{(e(Se)||e(T))&&a(br)})}h(()=>{Ne.disabled=e(Y)==="none"||e(_e),ra.disabled=!e(G)||e(Se)||e(fe),oa.disabled=!e(D)||e(T),ms.disabled=!e(G)&&!e(j),$e(St,"aria-expanded",e(ta))}),$("change",Ba,a=>{var r;const s=((r=a.target.files)==null?void 0:r[0])||null;t(G,s),t(Je,s?Ot(s.size):null),s&&setTimeout(()=>_a(),100)}),$("drop",ma,Cs),$("dragover",ma,Ms),ia(Kt,()=>e(J),a=>t(J,a)),Oe(ga,()=>e(Be),a=>t(Be,a)),Oe(Va,()=>e(He),a=>t(He,a)),Oe(ba,()=>e(Ee),a=>t(Ee,a)),$("change",ba,a=>Et(a.target.value)),Oe(Ra,()=>e(Y),a=>t(Y,a)),Oe(tt,()=>e(ye),a=>t(ye,a)),Oe(Ne,()=>e(le),a=>t(le,a)),$("change",Ne,a=>{const s=parseInt(a.target.value);Number.isNaN(s)||t(va,s)}),Oe(pt,()=>e(Le),a=>t(Le,a)),ia(as,()=>e(ka),a=>t(ka,a)),ia(ts,()=>e(Sa),a=>t(Sa,a)),ia(ss,()=>e(Ye),a=>t(Ye,a)),ia(os,()=>e(Re),a=>t(Re,a)),ca(ns,()=>e(ze),a=>t(ze,a)),ca(is,()=>e(De),a=>t(De,a)),ca(cs,()=>e(_e),a=>t(_e,a)),ca(ps,()=>e(wa),a=>t(wa,a)),$("click",ra,_a),$("click",oa,zs),$("click",ms,Is),$("click",St,ws),v(A,Bt),jr()}export{xl as component};
