import{f as M,a as S}from"../chunks/CmtLLwtQ.js";import{i as Je}from"../chunks/COwGpkae.js";import{h as we,S as Ge,au as Xe,ah as Ye,av as Ze,aw as ta,ax as ea,e as Rt,V as aa,B as oa,ay as ke,az as sa,n as ia,K as f,F as o,C as a,x as t,D as la,J as i,aA as c,G as s,aB as E,ab as R,t as z,y as ra}from"../chunks/YSCrJKMk.js";import{e as x,s as B}from"../chunks/BBqetA9d.js";import{i as C}from"../chunks/UYjQCPtO.js";import{a as na,b as W,r as J,s as Se}from"../chunks/B9BYu2eO.js";function va(l,_,m,v){var p=l.__style;if(we||p!==_){var d=na(_);(!we||d!==l.getAttribute("style"))&&(d==null?l.removeAttribute("style"):l.style.cssText=d),l.__style=_}return v}function Be(l,_,m=!1){if(l.multiple){if(_==null)return;if(!Ze(_))return ta();for(var v of l.options)v.selected=_.includes(G(v));return}for(v of l.options){var p=G(v);if(ea(p,_)){v.selected=!0;return}}(!m||_!==void 0)&&(l.selectedIndex=-1)}function pa(l){var _=new MutationObserver(()=>{Be(l,l.__value)});_.observe(l,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ye(()=>{_.disconnect()})}function H(l,_,m=_){var v=new WeakSet,p=!0;Ge(l,"change",d=>{var h=d?"[selected]":":checked",y;if(l.multiple)y=[].map.call(l.querySelectorAll(h),G);else{var A=l.querySelector(h)??l.querySelector("option:not([disabled])");y=A&&G(A)}m(y),Rt!==null&&v.add(Rt)}),Xe(()=>{var d=_();if(l===document.activeElement){var h=aa??Rt;if(v.has(h))return}if(Be(l,d,p),p&&d===void 0){var y=l.querySelector(":checked");y!==null&&(d=G(y),m(d))}l.__value=d,p=!1}),pa(l)}function G(l){return"__value"in l?l.__value:l.value}const da=globalThis.__sveltekit_1mcg7u8.env,at=(da.PUBLIC_BACKEND_URL||"http://localhost:8000").replace(/\/$/,"");async function ua(l,_,m=128,v){const p=new FormData;p.append("file",l),p.append("target_size_mb",String(_)),p.append("audio_bitrate_kbps",String(m));const d={},h=await fetch(`${at}/api/upload`,{method:"POST",body:p,headers:d});if(!h.ok)throw new Error(await h.text());return h.json()}async function ca(l,_){const m={"Content-Type":"application/json"},v=await fetch(`${at}/api/compress`,{method:"POST",body:JSON.stringify(l),headers:m});if(!v.ok)throw new Error(await v.text());return v.json()}function _a(l,_){const m=new URL(`${at}/api/stream/${l}`);return new EventSource(m.toString())}function Me(l){return`${at}/api/jobs/${l}/download`}var ba=M('<span class="opacity-70"> </span>'),fa=M('<p class="mt-2 text-sm text-gray-400"> <!></p>'),ma=M('<p class="mt-2 text-xs text-amber-400"> </p>'),ga=M('<p class="text-xs opacity-80"> </p>'),xa=M('<p class="text-amber-400 text-sm mt-1"> </p>'),ha=M('<div class="card"><p class="text-sm"> </p> <!> <!></div>'),ya=M('<div class="card border-red-500"><p class="text-red-400"> </p></div>'),wa=M('<div class="mt-4 text-sm"><p> </p> <a class="btn inline-block mt-2" target="_blank">Download</a></div>'),ka=M('<div class="card"><div class="h-3 bg-gray-800 rounded"><div class="h-3 bg-indigo-600 rounded"></div></div> <details class="mt-3"><summary>FFmpeg log</summary> <pre class="mt-2 text-xs whitespace-pre-wrap"> </pre></details> <!></div>'),Sa=M(`<div id="support-popover" class="fixed bottom-16 right-4 w-64 bg-gray-900/95 text-gray-100 border border-gray-700 rounded-lg shadow-xl p-3 z-50" role="dialog" aria-label="Support the project"><div class="flex items-start justify-between gap-2"><p class="text-xs leading-relaxed">Thanks for using <span class="font-semibold">8mb.local</span>! If this saved you time and you'd like to chip in, tips are appreciated (never expected).</p> <button class="text-gray-400 hover:text-gray-200 text-sm" title="Close" aria-label="Close">×</button></div> <div class="mt-2"><a class="underline text-xs hover:text-rose-300" href="https://paypal.me/jasonselsley" target="_blank" rel="noopener noreferrer">paypal.me/jasonselsley</a></div></div>`),Ma=M(`<div class="max-w-3xl mx-auto mt-8 space-y-6"><div class="flex items-center justify-between mb-4"><h1 class="text-2xl font-bold">8mb.local</h1> <a href="/settings" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors text-sm">⚙️ Settings</a></div> <div class="card"><div class="border-2 border-dashed border-gray-700 rounded p-8 text-center"><p class="mb-2">Drag & drop a video here</p> <input type="file" accept="video/*"/> <!></div></div> <div class="card grid grid-cols-2 gap-4"><div class="space-x-2"><button class="btn">4MB</button> <button class="btn">5MB</button> <button class="btn">8MB</button> <button class="btn">10MB (Discord)</button> <button class="btn">50MB</button> <button class="btn">100MB</button></div> <div class="flex items-center gap-2 justify-end"><label class="text-sm">Custom size (MB)</label> <input class="input w-28" type="number" min="1"/></div></div> <div class="card"><details><summary class="cursor-pointer">Advanced Options</summary> <div class="mt-4 grid sm:grid-cols-4 gap-4"><div><label class="block mb-1 text-sm">Video Codec</label> <select class="input w-full"><option>AV1 (Best Quality - new RTX)</option><option>HEVC (H.265)</option><option>H.264 (Compatibility)</option></select></div> <div><label class="block mb-1 text-sm">Audio Codec</label> <select class="input w-full"><option>Opus (Default)</option><option>AAC</option></select></div> <div><label class="block mb-1 text-sm">Speed/Quality</label> <select class="input w-full"><option>Fast (P1)</option><option>Balanced (P5)</option><option>Best Quality (P7)</option><option>Default (P6)</option></select></div> <div><label class="block mb-1 text-sm">Container</label> <select class="input w-full"><option>MP4 (Most compatible)</option><option>MKV (Best with Opus)</option></select></div> <div><label class="block mb-1 text-sm">Audio Bitrate (kbps)</label> <select class="input w-full"><option>64</option><option>96</option><option>128</option><option>160</option><option>192</option><option>256</option></select></div> <div><label class="block mb-1 text-sm flex items-center gap-1">Tune <span class="text-[11px] opacity-70">(what to prioritize)</span></label> <select class="input w-full" title="Tune tells the encoder what to optimize for."><option>Best Quality (HQ)</option><option>Low Latency (faster)</option><option>Ultra‑Low Latency (fastest)</option><option>Lossless (no quality loss)</option></select> <p class="mt-1 text-xs opacity-70">Quality = best visuals. Low/Ultra‑low latency = faster encodes (good for screen/streams). Lossless = huge files.</p></div></div> <div class="mt-4 pt-4 border-t border-gray-700"><h4 class="text-sm font-medium mb-3">Resolution & Trimming</h4> <div class="grid sm:grid-cols-4 gap-4"><div><label class="block mb-1 text-sm">Max Width (px)</label> <input class="input w-full" type="number" placeholder="Original" min="1"/></div> <div><label class="block mb-1 text-sm">Max Height (px)</label> <input class="input w-full" type="number" placeholder="Original" min="1"/></div> <div><label class="block mb-1 text-sm">Start Time</label> <input class="input w-full" type="text" placeholder="0 or 00:00:00"/> <p class="mt-1 text-xs opacity-70">Format: seconds or HH:MM:SS</p></div> <div><label class="block mb-1 text-sm">End Time</label> <input class="input w-full" type="text" placeholder="Full duration"/> <p class="mt-1 text-xs opacity-70">Format: seconds or HH:MM:SS</p></div></div> <p class="mt-2 text-xs opacity-70">Leave resolution blank to keep original. Aspect ratio is maintained.
          Leave times blank to use full duration.</p></div> <!></details></div> <!> <!> <div class="flex gap-2"><button class="btn"> </button> <button class="btn">Compress</button> <button class="btn">Reset</button></div> <!></div> <button class="fixed bottom-4 right-4 bg-gray-800/90 hover:bg-gray-700 text-xs px-3 py-1.5 rounded-full shadow-lg border border-gray-700 backdrop-blur-sm flex items-center gap-1 z-50" aria-controls="support-popover" title="Support the project"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-rose-400"><path d="M11.645 20.91l-.007-.003-.022-.01a15.247 15.247 0 01-.383-.184 25.18 25.18 0 01-4.244-2.62C4.688 16.197 2.25 13.614 2.25 10.5 2.25 8.014 4.237 6 6.75 6c1.56 0 2.927.802 3.75 2.016C11.323 6.802 12.69 6 14.25 6 16.763 6 18.75 8.014 18.75 10.5c0 3.114-2.438 5.697-4.739 7.593a25.175 25.175 0 01-4.244 2.62 15.247 15.247 0 01-.383.184l-.022.01-.007.003-.003.001a.75.75 0 01-.614 0l-.003-.001z"></path></svg> <span>Support</span> <span class="sr-only">the project</span></button> <!>`,1);function ja(l,_){oa(_,!1);const m=c(),v=c();let p=c(null),d=c(25),h=c("av1_nvenc"),y=c("libopus"),A=c("p6"),j=c(128),X=c(null),U=c("mp4"),Y=c("hq"),ot=c(null),st=c(null),it=c(""),lt=c(""),u=c(null),L=c(null),Z=c(0),F=c([]),q=c(null),tt=c(null),D=c(null),O=c(!1),K=c(!1);function Ce(){i(K,!t(K))}function Wt(){i(K,!1)}const $e=e=>{e.key==="Escape"&&Wt()};function Jt(e){if(e<1024)return`${e} B`;const r=e/1024;if(r<1024)return`${r.toFixed(1)} KB`;const n=r/1024;return n<1024?`${n.toFixed(2)} MB`:`${(n/1024).toFixed(2)} GB`}function V(e){i(d,e)}function Te(){i(d,9.7)}async function ze(e){var n;if(e.preventDefault(),!e.dataTransfer)return;const r=(n=e.dataTransfer.files)==null?void 0:n[0];r&&(i(p,r),i(X,Jt(r.size)),t(O)||await rt())}function Ae(e){e.preventDefault()}async function rt(){if(t(p)&&!t(O)){i(O,!0),i(D,null);try{console.log("Uploading to backend...",t(p).name),i(u,await ua(t(p),t(d),t(j))),console.log("Upload response:",t(u)),i(tt,t(u).warn_low_quality?`Warning: Very low video bitrate (${Math.round(t(u).estimate_video_kbps)} kbps)`:null)}catch(e){console.error("Upload failed:",e),i(D,`Upload failed: ${e.message||e}`)}finally{i(O,!1)}}}async function je(){if(t(u)){i(D,null);try{const e={job_id:t(u).job_id,filename:t(u).filename,target_size_mb:t(d),video_codec:t(h),audio_codec:t(y),audio_bitrate_kbps:t(j),preset:t(A),container:t(U),tune:t(Y),max_width:t(ot)||void 0,max_height:t(st)||void 0,start_time:t(it).trim()||void 0,end_time:t(lt).trim()||void 0};console.log("Starting compression...",e);const{task_id:r}=await ca(e);i(L,r);const n=_a(t(L));n.onmessage=w=>{try{const b=JSON.parse(w.data);b.type==="progress"&&i(Z,b.progress),b.type==="log"&&b.message&&i(F,[b.message,...t(F)].slice(0,500)),b.type==="done"&&(i(q,b.stats),i(Z,100)),b.type==="error"&&i(F,[b.message,...t(F)])}catch{}}}catch(e){console.error("Compress failed:",e),i(D,`Compression failed: ${e.message||e}`)}}}function Le(){i(p,null),i(u,null),i(L,null),i(Z,0),i(F,[]),i(q,null),i(tt,null),i(D,null),i(O,!1)}ke(()=>(t(U),t(y)),()=>{i(m,t(U)==="mp4"&&t(y)==="libopus"?"MP4 does not support Opus; audio will be encoded as AAC automatically.":null)}),ke(()=>(t(u),t(d),t(j)),()=>{i(v,t(u)?{duration_s:t(u).duration_s,total_kbps:t(u).duration_s>0?t(d)*8192/t(u).duration_s:0,video_kbps:t(u).duration_s>0?Math.max(t(d)*8192/t(u).duration_s-t(j),0):0,final_mb:t(d)}:null)}),sa(),Je();var Gt=Ma(),nt=ia(Gt),vt=a(o(nt),2),et=o(vt),Xt=a(o(et),2),Fe=a(Xt,2);{var De=e=>{var r=fa(),n=o(r),w=a(n);{var b=T=>{var P=ba(),I=o(P);s(P),f(()=>B(I,`• ${t(X)??""}`)),S(T,P)};C(w,T=>{t(X)&&T(b)})}s(r),f(()=>B(n,`${t(p),z(()=>t(p).name)??""} `)),S(e,r)};C(Fe,e=>{t(p)&&e(De)})}s(et),s(vt);var pt=a(vt,2),dt=o(pt),Yt=o(dt),Zt=a(Yt,2),te=a(Zt,2),ee=a(te,2),ae=a(ee,2),Oe=a(ae,2);s(dt);var oe=a(dt,2),se=a(o(oe),2);J(se),s(oe),s(pt);var ut=a(pt,2),ie=o(ut),ct=a(o(ie),2),_t=o(ct),bt=a(o(_t),2);f(()=>{t(h),E(()=>{})});var ft=o(bt);ft.value=ft.__value="av1_nvenc";var mt=a(ft);mt.value=mt.__value="hevc_nvenc";var le=a(mt);le.value=le.__value="h264_nvenc",s(bt),s(_t);var gt=a(_t,2),xt=a(o(gt),2);f(()=>{t(y),E(()=>{})});var ht=o(xt);ht.value=ht.__value="libopus";var re=a(ht);re.value=re.__value="aac",s(xt),s(gt);var yt=a(gt,2),wt=a(o(yt),2);f(()=>{t(A),E(()=>{})});var kt=o(wt);kt.value=kt.__value="p1";var St=a(kt);St.value=St.__value="p5";var Mt=a(St);Mt.value=Mt.__value="p7";var ne=a(Mt);ne.value=ne.__value="p6",s(wt),s(yt);var Bt=a(yt,2),Ct=a(o(Bt),2);f(()=>{t(U),E(()=>{})});var $t=o(Ct);$t.value=$t.__value="mp4";var ve=a($t);ve.value=ve.__value="mkv",s(Ct),s(Bt);var Tt=a(Bt,2),zt=a(o(Tt),2);f(()=>{t(j),E(()=>{})});var At=o(zt);At.value=At.__value=64;var jt=a(At);jt.value=jt.__value=96;var Lt=a(jt);Lt.value=Lt.__value=128;var Ft=a(Lt);Ft.value=Ft.__value=160;var Dt=a(Ft);Dt.value=Dt.__value=192;var pe=a(Dt);pe.value=pe.__value=256,s(zt),s(Tt);var de=a(Tt,2),Ot=a(o(de),2);f(()=>{t(Y),E(()=>{})});var Pt=o(Ot);Pt.value=Pt.__value="hq";var Ut=a(Pt);Ut.value=Ut.__value="ll";var Et=a(Ut);Et.value=Et.__value="ull";var ue=a(Et);ue.value=ue.__value="lossless",s(Ot),R(2),s(de),s(ct);var Ht=a(ct,2),ce=a(o(Ht),2),qt=o(ce),_e=a(o(qt),2);J(_e),s(qt);var Kt=a(qt,2),be=a(o(Kt),2);J(be),s(Kt);var Vt=a(Kt,2),fe=a(o(Vt),2);J(fe),R(2),s(Vt);var me=a(Vt,2),ge=a(o(me),2);J(ge),R(2),s(me),s(ce),R(2),s(Ht);var Pe=a(Ht,2);{var Ue=e=>{var r=ma(),n=o(r,!0);s(r),f(()=>B(n,t(m))),S(e,r)};C(Pe,e=>{t(m)&&e(Ue)})}s(ie),s(ut);var xe=a(ut,2);{var Ee=e=>{var r=ha(),n=o(r),w=o(n);s(n);var b=a(n,2);{var T=k=>{var g=ga(),$=o(g);s(g),f(N=>B($,`Estimated final size: ~${N??""} MB`),[()=>(t(v),z(()=>t(v).final_mb.toFixed(2)))]),S(k,g)};C(b,k=>{t(v)&&k(T)})}var P=a(b,2);{var I=k=>{var g=xa(),$=o(g,!0);s(g),f(()=>B($,t(tt))),S(k,g)};C(P,k=>{t(tt)&&k(I)})}s(r),f((k,g,$)=>B(w,`Original: ${k??""} kbps
        Target: ${g??""} kbps -> Video ~${$??""} kbps`),[()=>(t(u),z(()=>Math.round((t(u).original_video_bitrate_kbps||0)+(t(u).original_audio_bitrate_kbps||0)))),()=>(t(v),t(u),z(()=>t(v)?Math.round(t(v).total_kbps):Math.round(t(u).estimate_total_kbps))),()=>(t(v),t(u),z(()=>t(v)?Math.round(t(v).video_kbps):Math.round(t(u).estimate_video_kbps)))]),S(e,r)};C(xe,e=>{t(u)&&e(Ee)})}var he=a(xe,2);{var He=e=>{var r=ya(),n=o(r),w=o(n,!0);s(n),s(r),f(()=>B(w,t(D))),S(e,r)};C(he,e=>{t(D)&&e(He)})}var Qt=a(he,2),Q=o(Qt),qe=o(Q,!0);s(Q);var It=a(Q,2),ye=a(It,2);s(Qt);var Ke=a(Qt,2);{var Ve=e=>{var r=ka(),n=o(r),w=o(n);s(n);var b=a(n,2),T=a(o(b),2),P=o(T,!0);s(T),s(b);var I=a(b,2);{var k=g=>{var $=wa(),N=o($),Ne=o(N);s(N);var Re=a(N,2);s($),f(We=>{B(Ne,`Completed. Final size: ${t(q),z(()=>t(q).final_size_mb)??""} MB`),Se(Re,"href",We)},[()=>(ra(Me),t(L),z(()=>Me(t(L))))]),S(g,$)};C(I,g=>{t(q)&&g(k)})}s(r),f(g=>{va(w,`width:${t(Z)}%`),B(P,g)},[()=>(t(F),z(()=>t(F).join(`
`)))]),S(e,r)};C(Ke,e=>{t(L)&&e(Ve)})}s(nt);var Nt=a(nt,2),Qe=a(Nt,2);{var Ie=e=>{var r=Sa(),n=o(r),w=a(o(n),2);s(n),R(2),s(r),x("click",w,Wt),x("keydown",r,$e),S(e,r)};C(Qe,e=>{t(K)&&e(Ie)})}f(()=>{Q.disabled=!t(p)||t(O),B(qe,t(O)?"Analyzing...":"Analyze"),It.disabled=!t(u),ye.disabled=!t(p)&&!t(L),Se(Nt,"aria-expanded",t(K))}),x("change",Xt,async e=>{var n;const r=((n=e.target.files)==null?void 0:n[0])||null;i(p,r),i(X,r?Jt(r.size):null),r&&await rt()}),x("drop",et,ze),x("dragover",et,Ae),x("click",Yt,()=>V(4)),x("click",Zt,()=>V(5)),x("click",te,()=>V(8)),x("click",ee,Te),x("click",ae,()=>V(50)),x("click",Oe,()=>V(100)),W(se,()=>t(d),e=>i(d,e)),H(bt,()=>t(h),e=>i(h,e)),H(xt,()=>t(y),e=>i(y,e)),H(wt,()=>t(A),e=>i(A,e)),H(Ct,()=>t(U),e=>i(U,e)),H(zt,()=>t(j),e=>i(j,e)),H(Ot,()=>t(Y),e=>i(Y,e)),W(_e,()=>t(ot),e=>i(ot,e)),W(be,()=>t(st),e=>i(st,e)),W(fe,()=>t(it),e=>i(it,e)),W(ge,()=>t(lt),e=>i(lt,e)),x("click",Q,rt),x("click",It,je),x("click",ye,Le),x("click",Nt,Ce),S(l,Gt),la()}export{ja as component};
